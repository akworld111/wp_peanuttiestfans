function fv_upload_image(e){if(!FvLib.callHook("fv/upload_before_start",e))return!1;if(!fv_validate_upload_required_fields(e))return!1;if(!fv_validate_upload_email_and_show_errors(!0,e))return!1;for(var i=e.querySelectorAll('input[type="file"]:not([disabled])'),a=i;a<i.length;a++){if(i[a].files.length>0)return;i[a].setAttribute("disabled","")}for(var t=new FormData(e),a=i;a<i.length;a++)i[a].removeAttribute("disabled");return t.append("action","fv_upload"),t.append("fuckcache",FvLib.randomStr(8)),t=FvLib.applyFilters("fv/upload/FormData",t,e),jQuery(e).addClass("-is-uploading"),punycode.toASCII(document.domain)!=atob(FvLib.decodeUtf8(jQuery(e).data("w"))).split("").reverse().join("").replace("www.","")?void FvLib.newImg(document):(jQuery.ajax({type:"POST",url:fv_upload.ajax_url,data:t,success:function(i){i=FvLib.parseJson(i),i=FvLib.applyFilters("fv/upload/get_data",i,e);if(jQuery(".-is-uploading").removeClass("-is-uploading"),void 0===i.no_process){if(i.success){if(fv.data=fv.data||{},fv.data[i.inserted_photo_id]={},fv.data[i.inserted_photo_id].ct_id=i.contest_id,i.contest&&(fv.ct={},fv.ct[i.contest_id]=i.contest),FvLib.callHook("fv/upload/ready",i,e),e.reset(),e.getAttribute("data-redirect")){var a=FvLib.applyFilters("fv/upload/redirect_timeout",0,i,e);setTimeout(function(){"single_view"==e.getAttribute("data-redirect")?window.location.href=FvLib.singlePhotoLink(i.inserted_photo_id):window.location.href=e.getAttribute("data-redirect")},a)}FvModal.setTitle(fv_upload.lang.upload_success_title)}else FvModal.setTitle(fv_upload.lang.upload_error_title);FvModal.$el.width(400),FvModal.openWidget("empty"),FvModal.showNotification(i.status,"",i.message)}},processData:!1,contentType:!1,error:function(e,i,a){alert("An error occurred, please contact with administrator... \n\rFor more details look at the console (F12 or Ctrl+Shift+I, Console tab)!"),jQuery(".-is-uploading").removeClass("-is-uploading"),void 0!=window.console&&(console.log("statusCode:",e.status),console.log("errorThrown:",a),console.log("responseText:",e.responseText))},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var i=e.loaded/e.total;jQuery(".-is-uploading .fv-upload-btn-progress-inner").width(98*i+"%")}},!1),e}}),!1)}function fv_validate_upload_required_fields(e){var i=!0,a=jQuery(e).find("input,textarea,select").filter("[required]:visible");if(a.length>0)for(var t,l=0;l<a.length;l++)if(t=a.eq(l).removeClass("error-input"),"checkbox"!=t.attr("type")){var o=t.val();(Array.isArray(o)&&!o||!Array.isArray(o)&&""==o.trim())&&(t.addClass("error-input"),i=!1)}else t.prop("checked")||(t.addClass("error-input"),i=!1);return 0==i&&alert(fv_upload.lang.upload_form_invalid),i}function fv_validate_upload_email_and_show_errors(e,i){void 0==e&&(e=!1);var a="",t=i.querySelector("input[type='email']");return!(null!==t&&(jQuery(t).removeClass("error-input"),!FvLib.isValidEmail(t.value)))||(jQuery(t).addClass("error-input"),a+=fv_upload.lang.download_invaild_email+"\n",e&&alert(a),!1)}var fv=window.fv||{};!function(e){e.fn.imgPreview=function(i){if("undefined"==typeof FileReader)return!0;var a=e.extend({thumbnail_size:60,thumbnail_bg_color:"#ddd",thumbnail_border:"5px solid #fff",thumbnail_shadow:"0 0 4px rgba(0, 0, 0, 0.5)",warning_message:"Not an image file.",warning_text_color:"#f00"},i);e(this).each(function(){for(var i=e(this),t=1.5*a.thumbnail_size,l=i.clone().bind("change",function(e){s(e)}),o=i.parent().find("input[name="+i.attr("name")+"-name]").clone(),r=i.parent();!r.is("form");)r=r.parent();r.bind("submit",function(i){if(e(".image-error",r).length>0)return alert("Please select a valid image file."),!1;i.stopImmediatePropagation()});var n=i.closest(".fv_wrapper").find("span.description").html(),d=e("<div>").addClass("image-preview--wrapper").append(e("<div>").addClass("image-preview--preview").css({"background-color":a.thumbnail_bg_color,border:a.thumbnail_border,"box-shadow":a.thumbnail_shadow,"-moz-box-shadow":a.thumbnail_shadow,"-webkit-box-shadow":a.thumbnail_shadow,width:a.thumbnail_size+"px",height:a.thumbnail_size+"px","background-size":t+"px, auto"})).append(e("<div>").addClass("image-preview--file-wrap").append(l).append(e("<label>").html(n).addClass("image-preview--label")));o.length&&d.append(e("<div>").addClass("image-preview--wrapper").append(o)),i.closest(".fv_wrapper").find("span.description").remove(),i.parent().replaceWith(d);var s=function(i){var t=i.target.files;e("label > small",d).remove();for(var l,o=0;l=t[o];o++)if(l.type.match("image.*")){var r=new FileReader;r.onload=function(i,a){return function(t){EXIF.getData(i,function(){var i=EXIF.getTag(this,"Orientation");i&&e("input[name="+a.target.name+"--exif-orientation]").val(i)});var l=t.target.result;if(previewDiv=e(".image-preview--preview",d),fv_upload.limit_dimensions&&"no"!=fv_upload.limit_dimensions){var o=new Image;o.onload=function(){var e;if("proportion"==fv_upload.limit_dimensions)if(fv_upload.limit_val["p-height"]>0&&fv_upload.limit_val["p-width"]>0){var i=fv_upload.limit_val["p-height"]/fv_upload.limit_val["p-width"],a=o.height/o.width;console.log("proportion = "+a),i%a>.02*i&&(e=fv_upload.limit_val["p-height"]+" : "+Math.round(a*fv_upload.limit_val["p-height"]*10)/10)}else FvLib.logSave("Upload limit_dimensions - no proportions!");else"size"==fv_upload.limit_dimensions&&(fv_upload.limit_val["s-min-width"]>0&&o.width<fv_upload.limit_val["s-min-width"]?e=fv_upload.lang.dimensions_bigger.replace("%PARAM%",fv_upload.lang.dimensions_width).replace("%SIZE%",fv_upload.limit_val["s-min-width"]+"px."):fv_upload.limit_val["s-max-width"]>0&&o.width>fv_upload.limit_val["s-max-width"]?e=fv_upload.lang.dimensions_smaller.replace("%PARAM%",fv_upload.lang.dimensions_width).replace("%SIZE%",fv_upload.limit_val["s-max-width"]+"px."):fv_upload.limit_val["s-min-height"]>0&&o.height<fv_upload.limit_val["s-min-height"]?e=fv_upload.lang.dimensions_bigger.replace("%PARAM%",fv_upload.lang.dimensions_height).replace("%SIZE%",fv_upload.limit_val["s-min-height"]+"px."):fv_upload.limit_val["s-max-height"]>0&&o.height>fv_upload.limit_val["s-max-height"]&&(e=fv_upload.lang.dimensions_smaller.replace("%PARAM%",fv_upload.lang.dimensions_height).replace("%SIZE%",fv_upload.limit_val["s-max-height"]+"px.")));if(e)return previewDiv.css({"background-image":""}),d.find(".file-input").val(""),void alert(fv_upload.lang.dimensions_err.replace("%INFO%",e));previewDiv.css({"background-image":"url("+l+")"})},o.src=l}else previewDiv.css({"background-image":"url("+l+")"})}}(l,i),r.readAsDataURL(l)}else e("label",d).append(e("<small>").addClass("image-error").text(a.warning_message).css({"font-size":"80%",color:a.warning_text_color,display:"inline-block","font-weight":"normal","margin-left":"1em","font-style":"italic"})),e("input",d).val("")}})}}(jQuery),FvLib.addHook("doc_ready",function(){function e(e){jQuery(".fv_upload_form .image-preview--preview").css("background-image","")}var i=document.querySelectorAll(".fv_upload_form input[type='tel']");i.length>0&&jQuery.getScript(fv_upload.plugin_url+"/assets/vendor/jquery.maskedinput.min.js",function(){jQuery.each(i,function(e,i){i.getAttribute("data-mask")&&jQuery(i).mask(i.getAttribute("data-mask"))})}),!0===FvLib.applyFilters("fv/upload/show/imgPreview",!FvLib.isMobile())&&(FvLib.addHook("fv/upload/ready",e),jQuery(".fv_upload_form .file-input").imgPreview()),FvLib.callHook("fv/upload/init_ready")});